<!DOCTYPE HTML>
<html lang="en" class="flint sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Variant Comparison - The Flint Wiki</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/flint.css">
        <link rel="stylesheet" href="../../theme/flint-highlight.css">
        <link rel="stylesheet" href="../../version_select.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "flint";
            const default_dark_theme = "flint";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('flint')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Flint Wiki</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="variant-comparison"><a class="header" href="#variant-comparison">Variant Comparison</a></h1>
<p>We can compare variants with quite a few of different things. <em>Comparing</em> means the equals and not-equals operations <code>==</code> and <code>!=</code>, nothing else. We cannot see if one variant is bigger than another variant, for example, but we can definitely see if they are equal to one another. We can also compare variants to types to see if they contain a value of that type. But, let's look at all different cases in isolation.</p>
<h2 id="comparing-types"><a class="header" href="#comparing-types">Comparing Types</a></h2>
<p>We can compare a variant to a type to do a quick "does it hold a value of that type" check:</p>
<pre><code class="language-ft">use Core.print

variant MyVar:
	i32, f32, bool;

def main():
	MyVar var = f32(3.14);

	if var == i32:
		print("holds i32 value\n");
	else if var == f32:
		print("holds f32 value\n");
	else if var == bool:
		print("holds bool value\n");
</code></pre>
<p>This program will print this line to the console:</p>
<blockquote>
<pre><code>holds f32 value
</code></pre>
</blockquote>
<p>The <code>== T</code> check actually is semantically more of a <em>Does it hold a value of type <code>T</code>?</em> check. If you look closely, you can see the similarity of the above code with a switch statement:</p>
<pre><code class="language-ft">use Core.print

variant MyVar:
	i32, f32, bool;

def main():
	MyVar var = f32(3.14);

	switch var:
		i32(v):  print("holds i32 value\n");
		f32(v):  print("holds f32 value\n");
		bool(v): print("holds bool value\n");
</code></pre>
<p>with the same output as the other program. But in a switch we direclty gain an additional reference to the inner value of the variant we are working with. But, if we only want to do an action on only one type of the variant and do <em>nothing</em> on all other types, we can't really express this through a switch statement. Because how do we define doing "nothing" in a switches branch? That simply isn't possible in Flint.</p>
<p>So, for that reason we can compare variants to types to see if it holds a value of that type. Note that <code>T</code> must be a valid type of the variant. If <code>T</code> is not a valid type of the variant, you will get a compile error stating that the type you try to compare the variant with is not a part of the variant's possible types.</p>
<h2 id="comparing-tags"><a class="header" href="#comparing-tags">Comparing Tags</a></h2>
<p>Just like we can compare a variant to it's type, we can compare a variant to it's tag to see if it holds a value of that type. As described in the chapter about tagged variants, a variation with a tag <strong>must</strong> be accessed and checked through the very same tag.</p>
<pre><code class="language-ft">use Core.print

variant MyVar:
	Int(i32), Float(f32), bool;

def main():
	MyVar var = i32(-7);

	if var == MyVar.Int:
		print("holds Int value\n");
	else if var == MyVar.Float:
		print("holds Float value\n");
	else if var == bool:
		print("holds bool value\n");
</code></pre>
<p>This program will print this line to the console:</p>
<blockquote>
<pre><code>holds Int value
</code></pre>
</blockquote>
<p>Just like in the last example, the similarity to the switch statement is pretty easy to spot:</p>
<pre><code class="language-ft">use Core.print

variant MyVar:
	Int(i32), Float(f32), bool;

def main():
	MyVar var = f32(3.14);

	switch var:
		MyVar.Int(v):   print("holds Int value\n");
		MyVar.Float(v): print("holds Float value\n");
		bool(v):        print("holds bool value\n");
</code></pre>
<p>which will have the same output once again. So, as you can see we can compare a variant value with one of it's possible tags in addition to comparing it with it's possible types. But, just like described in the chapter about tagged variants, we cannot do <code>var == i32</code>, even though <code>i32</code> is a valid type of the variant. We <strong>must</strong> check against it's tag when comparing and are not allowed to compare it to the underlying type directly if a tag is provided.</p>
<h2 id="comparing-variants"><a class="header" href="#comparing-variants">Comparing Variants</a></h2>
<p>Comparing two variants is pretty straight forward. Two variant's are considered to be equal if both their types as well as their values match up. You already know that the underlying structure of a variant is a <code>{ u8, byte[N] }</code>. Given this information you could quickly see that we cannot just compare the whole structure of a variant to another structure and if they are equal the variants are considered equal. It is a bit more nuanced than that. Let's say that we have the variant <code>variant&lt;i32, f32, i64&gt;</code>. In that case the variant has space for <code>8</code> bytes. So, if we have two variables and store <code>-1</code> and <code>1</code> as an <code>i64</code> in both of them all 8 bytes of the variant structure will be set. But if we then store the <code>i32</code> value of <code>7</code> in both of them, only the fist 4 bytes are overwritten and the last 4 bytes stay the same as they were before.
This means that comparing variants through their whole structure would not only compare what <strong>is</strong> stored in the variants but also what <strong>was</strong> stored in them, and this is semantically very incorrect. When we compare both variants and both hold an <code>i32</code> value and that <code>i32</code> value matches, they should be considered equal. Relying on the whole structure would actually be undefined behaviour, and we don't want that. So, that's why we only compare the first <code>N</code> bytes depending on the active type of the variant. That's more work internally, but it results in deterministic and defined behaviour.</p>
<p>So, here is a small example of comparing variants to one another:</p>
<pre><code class="language-ft">use Core.print

variant MyVar:
	i32, i64, i32x3;

def main():
	MyVar var_1 = i64(-5);
	MyVar var_2 = i64(6);

	if var_1 == var_2:
		print("are equal\n");
	else:
		print("differ\n");

	var_1 = i32(5);
	var_2 = i32(5);
	if var_1 == var_2:
		print("are equal\n");
	else:
		print("differ\n");
</code></pre>
<p>This program will print these lines to the console:</p>
<blockquote>
<pre><code>differ
are equal
</code></pre>
</blockquote>
<p>This output is expected. When we store different <code>i64</code> values in the variant they obviously do not match and then we store two equal <code>i32</code> values in the variant, so the variants should equal each other. If we would compare the whole structures of the variant to one another the second comparison of the two <code>i32</code> values would yield <code>false</code> which would be extremely counter-intuitive.</p>
<h2 id="the-active_type-field"><a class="header" href="#the-active_type-field">The <code>active_type</code> field</a></h2>
<p>Next we look at accessing the <code>active_type</code> field of the variant. You know the strucutre of the variant is <code>{ u8, byte[N] }</code> and the <code>active_type</code> field of a variant is the first field of that struct. We can access this value (readonly) by just doing <code>var.active_type</code> on an variant. This will return a <code>u8</code> value. And because we can compare <code>u8</code> values we can actually check whether two variant variables hold <strong>the same type</strong>. This is especially useful for situations where we just want to know whether two variants hold the same type, independent from <em>which</em> type that is.</p>
<pre><code class="language-ft">use Core.print

variant MyVar:
	i32, i64, i32x3;

def main():
	MyVar var_1 = i64(-5);
	MyVar var_2 = i64(6);

	if var_1.active_type == var_2.active_type:
		print("hold the same type\n");
	else:
		print("hold different types\n");

	var_1 = i32(5);
	if var_1.active_type == var_2.active_type:
		print("hold the same type\n");
	else:
		print("hold different types\n");
</code></pre>
<p>This program will print these lines to the console:</p>
<blockquote>
<pre><code>hold the same type
hold different types
are equal
</code></pre>
</blockquote>
<p>You will see in the next big chapter about <a href="/intermediates_guide/3_error_sets.html">Error Sets</a> and you actually have seen it before for getting the <a href="/beginners_guide/6_arrays/3_strings.html#getting-a-strings-length">length of strings</a> that you can access fields of primitive types or builtin types, fields which you normally do not see.</p>
<p>Note that the <code>active_type</code> indices start at <code>1</code>. This means that <code>i32</code> has the value <code>1</code>, <code>i64</code> the value <code>2</code> and <code>i32x3</code> the value <code>3</code>. Why the value <code>0</code> is not used here and why we have a one-based indexing in this case will be explained in a <a href="/intermediates_guide/2_variants/8_optional_variants.html">later</a> chapter, stay tuned for that!</p>
<h2 id="comparing-values"><a class="header" href="#comparing-values">Comparing Values</a></h2>
<div class="warning">
<p>It is not yet entirely clear whether this feature will be implemented at all</p>
<p>While useful, this feature would make comparing variants ambiguous. When comparing a variant to a type or another variant of the same type it can be clearly seen what's actually happening. But in the example below, doing <code>var == ten</code> brings a bit of ambiguity with it, as now <code>ten</code> could be of type <code>MyVar</code>, <code>i32</code>, <code>i64</code> or <code>i32x3</code>. All types are entirely possible. For the parser this is no problem whatsoever, but for the person actually <em>reading</em> the Flint code this leads to additional cognitive load, whereas when <em>not</em> having this feature you can be sure that when you see <code>var == ten</code> that <code>ten</code> is definitely of type <code>MyVar</code> and can't be of any other type.
So, it is still thought about whether to actually implement this feature. It is not implemented for now, as it's just syntactic sugar and doing that comparison coould be done through other ways as well. We will reconsider adding this feature at a later point in time, when time has shown that we actually want and need it. But it is most likely for this feature to stay pretty uncommon.</p>
</div>
<p>Lastly, we can also compare variants to variables and literals of a given type directly. Just like we can do <code>var == i32</code> we can also do <code>var == 5</code> and this will do two checks for us: Is <code>var</code> of type <code>i32</code>? If yes, does it's value match the value we compare it to? It's the same as if we would write <code>var?(i32) != none and var!(i32) == 5</code> but we look at that syntax in the next chapter. Just be assured: It would be pretty hard to check if the variant matches a given value if this feature would not exist. This feature is something we would call syntactic sugar. It is not necessarily <em>required</em> to be implemented, but it makes our lives quite a lot easier.</p>
<pre><code class="language-ft">use Core.print

variant MyVar:
	i32, i64, i32x3;

def main():
	MyVar var = i64(-5);

	if var == i64(-5):
		print("equals i64(-5)\n");

	i32 ten = 10;
	var = i32(10);
	if var == i32(7):
		print("equals 7\n");
	else if var == ten:
		print("equals ten\n");
</code></pre>
<p>This program will print these lines to the console:</p>
<blockquote>
<pre><code>equals i64(-5)
equals ten
</code></pre>
</blockquote>
<p>As you can see it makes our lives quite a lot easier.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../intermediates_guide/2_variants/4_inline_variants.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../intermediates_guide/2_variants/6_unwrapping.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../intermediates_guide/2_variants/4_inline_variants.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../intermediates_guide/2_variants/6_unwrapping.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../version_select.js"></script>


    </div>
    </body>
</html>
