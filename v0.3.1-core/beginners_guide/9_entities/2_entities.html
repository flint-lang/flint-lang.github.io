<!DOCTYPE HTML>
<html lang="en" class="flint sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Entities - The Flint Wiki</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/flint.css">
        <link rel="stylesheet" href="../../theme/flint-highlight.css">
        <link rel="stylesheet" href="../../version_select.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "flint";
            const default_dark_theme = "flint";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('flint')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Flint Wiki</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="entities"><a class="header" href="#entities">Entities</a></h1>
<p>An <code>entity</code> is essentially a collection of data and functionality, similar to an <code>Object</code> or <code>Class</code> in OOP. DOCP is based on the concept of <strong>composition</strong> instead of <strong>inheritance</strong>, but more on that <a href="./3_composition.html">later</a>. You simply need to know that any entity is composed of <code>data</code> and <code>func</code> modules. Here is a small example of the most simple entity:</p>
<pre><code class="language-ft">use Core.print

data DTransform:
	i32x2 pos;
	i32x2 size;
	DTransform(pos, size);

func FMove requires(DTransform trans):
	def print():
		print($"pos: {trans.pos}, size: {trans.size}\n");

entity Entity:
	data: DTransform;
	func: FMove;
	Entity(DTransform);

def main():
	e := Entity(DTransform(i32x2(100, 120), i32x2(200, 220)));
	e.print();
</code></pre>
<p>This program will print this line to the console:</p>
<blockquote>
<pre><code>pos: (100, 120), size: (200, 220)
</code></pre>
</blockquote>
<p>There is <strong>a lot</strong> to talk about here. First of all, the syntax to define an entity is <em>weird</em> you might say. When defining an entity you <em>describe</em> which <code>data</code> and <code>func</code> module the entity consists of, and then you write a <strong>Constructor</strong> similar to how you do it for any <code>data</code> type, and in the constructor you define the order in which data needs to be passed to the entity when constructing it. In our case the entity only contains the <code>DTransform</code> data so there is no order to set.</p>
<p>As you can see, we can call the <code>print</code> function on the variable <code>e</code> of type <code>Entity</code> without passing in any data. On the call-side the function looks exactly like defined in the <code>FMove</code> func module, with no parameters. We can call the <code>print</code> function of the <code>FMove</code> func module because the entity <code>Entity</code> explicitely contains that func module's functions (via the <code>func: &lt;Type&gt;;</code> line).</p>
<p>Like you saw above, you do not need to pass any data to functions. This has one very simple explaination: An entity is simply a tuple of it's data. So, the <code>Entity</code> type at runtime is just <code>data&lt;DTransform&gt;</code> in our case. This means that the call <code>e.print()</code> from the above example actually resolves to code like <code>FMove.print(e.$0)</code>. This is how entities work under the hood, but entities have another important rule / concept: encapsulation.</p>
<h2 id="encapsulation"><a class="header" href="#encapsulation">Encapsulation</a></h2>
<p>The data of an entity can <strong>never</strong> be accessed from the outside world. This means that you cannot just write <code>e.$0</code> for example, since an entity is not a tuple on the surface. <strong>Entity data can only be modified from within functions defined in func modules</strong>. This means that whenever you want to modify any entity data you need to modify it through a call on the entity variable instance itself. An entity <strong>owns</strong> it's data, which means that you cannot get a reference to it's data by any means.</p>
<p>So, when you would want to get the position of the above entity then you would need to write something like this:</p>
<pre><code class="language-ft">use Core.print

data DTransform:
	i32x2 pos;
	i32x2 size;
	DTransform(pos, size);

func FMove requires(DTransform trans):
	def print():
		print($"pos: {trans.pos}, size: {trans.size}\n");

	def get_pos() -&gt; i32x2:
		return trans.pos;

entity Entity:
	data: DTransform;
	func: FMove;
	Entity(DTransform);

def main():
	e := Entity(DTransform(i32x2(100, 120), i32x2(200, 220)));
	e.print();
	print($"e.pos = {e.get_pos()}\n");
</code></pre>
<p>This program prints these lines to the console:</p>
<blockquote>
<pre><code>pos: (100, 120), size: (200, 220)
e.pos = (100, 120)
</code></pre>
</blockquote>
<p>This <em>may</em> seem inefficient or boiler-platy, but this design has big impications regarding multi-threading safety and general code safety, but this is a topic of a waaaay later chapter in the Expert to Master book.</p>
<h2 id="missing-data"><a class="header" href="#missing-data">Missing data</a></h2>
<p>There are only a few reasons to why we <code>require</code> any data in <code>func</code> modules at all. The first reason is that whenever we call a function like <code>print</code> on the entity <code>e</code> we <em>know</em> that this function <em>only</em> ever touches the <code>DTransform</code> data of the entity, but not any other data it may contain. This is crucial for parallelism. The other reason, which is more important now, is that the required data forms a <em>contract</em> to the entity. If the entity does not provide the data the func module requires then we get a compile error. Here is an example of just that:</p>
<pre><code class="language-ft">use Core.print

data DTransform:
	i32x2 pos;
	i32x2 size;
	DTransform(pos, size);

data DScale:
	f32x2 scale;
	DScale(scale);

func FMove requires(DTransform trans, DScale scale):
	def print():
		print($"pos: {trans.pos}, size: {trans.size}, scale: {scale.scale}\n");

	def get_pos() -&gt; i32x2:
		return trans.pos;

entity Entity:
	data: DTransform;
	func: FMove;
	Entity(DTransform);

def main():
	e := Entity(DTransform(i32x2(100, 120), i32x2(200, 220)));
	e.print();
	print($"e.pos = {e.get_pos()}\n");
</code></pre>
<p>This program prints this compile error:</p>
<blockquote>
<pre><code>Parse Error at main.ft:19:1
└──┬┤E0000│
19 │ entity Entity:
┌──┴─┘
└─ Entity type is missing data 'DScale' required by func module 'FMove'
</code></pre>
</blockquote>
<p>In this example we added the <code>DScale</code> data requirement to the <code>FMove</code> func module and the entity which uses it now needs to be updated to contain the new data that func module requires. To fix this problem we need to add the data type to the entity definition and to it's constructor:</p>
<pre><code class="language-ft">use Core.print

data DTransform:
	i32x2 pos;
	i32x2 size;
	DTransform(pos, size);

data DScale:
	f32x2 scale;
	DScale(scale);

func FMove requires(DTransform trans, DScale scale):
	def print():
		print($"pos: {trans.pos}, size: {trans.size}, scale: {scale.scale}\n");

	def get_pos() -&gt; i32x2:
		return trans.pos;

entity Entity:
	data: DTransform, DScale;
	func: FMove;
	Entity(DTransform, DScale);

def main():
	e := Entity(DTransform(i32x2(100, 120), i32x2(200, 220)), DScale(f32x2(3.3, 4.4)));
	e.print();
	print($"e.pos = {e.get_pos()}\n");
</code></pre>
<p>And now this program prints this code to the console:</p>
<blockquote>
<pre><code>pos: (100, 120), size: (200, 220), scale: (3.3, 4.4)
e.pos = (100, 120)
</code></pre>
</blockquote>
<p>As you can see, the explicit requirements of func modules are our friend here.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../beginners_guide/9_entities/1_func_modules.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../beginners_guide/9_entities/3_composition.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../beginners_guide/9_entities/1_func_modules.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../beginners_guide/9_entities/3_composition.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../version_select.js"></script>


    </div>
    </body>
</html>
